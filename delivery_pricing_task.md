# Задача: Расчёт стоимости доставки заказа

## Цель

Реализовать систему расчёта стоимости доставки конкретного заказа до конкретного адреса на основе:
- дистанции от склада до адреса клиента (по данным Яндекс.Карт);
- ограничений по типу транспорта для товаров в заказе;
- вместимости транспорта по объёму;
- тарифов на транспорт (стоимость за км и фиксированная стоимость за транспорт).

Склад (точка отправления) всегда один и тот же:

> 105187, г. Москва, г. Москва, Вернисажная ул., 6

## Изменения в данных

### Модель TransportRestriction

В модели `TransportRestriction` должны появиться следующие поля (наименования полей и типы данных подобрать в соответствии с практикой проекта):

1. **Вмещаемый объём**  
   - Описывает максимальный объём груза, который можно перевезти одним транспортным средством данного типа.  
   - Единицы измерения должны быть явно задокументированы (например, кубометры).

2. **Стоимость за км**  
   - Стоимость, которая начисляется за каждый километр пути для одного транспортного средства данного типа.  
   - Использовать числовой тип, подходящий для денежных значений в проекте.

3. **Стоимость за транспорт**  
   - Фиксированная стоимость за использование одного транспортного средства данного типа (например, подача машины).  
   - Также денежный тип, согласованный с остальными денежными полями проекта.

Предполагается, что у каждого товара уже есть связь с `TransportRestriction` (или аналогичным объектом), определяющая, каким типом транспорта его разрешено перевозить.

## Внешний сервис: Яндекс.Карты

Для расчёта расстояния от склада до адреса клиента необходимо использовать API Яндекс.Карт.

### Требования к использованию API

- На вход функции/сервиса расчёта доставки должен приходить полный адрес доставки из заказа.  
- Отправная точка всегда фиксированная:  
  `«105187, г. Москва, г. Москва, Вернисажная ул., 6»`.
- Через API Яндекс.Карт необходимо получить расстояние между точкой отправления и адресом заказа **в километрах**.
- Необходимо предусмотреть обработку ошибок и неуспешных ответов API (как именно — описать в коде и/или докстрингах).

## Логика определения необходимого транспорта

### 1. Определить максимальное ограничение по транспорту

Для каждого товара в заказе уже задано ограничение по транспорту (через `TransportRestriction` или эквивалент).

Необходимо:

1. Собрать все ограничения по транспорту для товаров в заказе.
2. Определить среди них **максимальное ограничение по транспорту**.  
   - Под «максимальным» понимать транспорт с наибольшей грузоподъёмностью/размером (то есть самый «крупный»/требовательный транспорт из тех, которые встречаются в заказе).  
   - Конкретные правила сравнения типов транспорта (если есть иерархия типов) нужно зафиксировать в коде/константах.

В дальнейшем для всего заказа используется этот «максимальный» тип транспорта.

### 2. Проверка размещения товаров по объёму в транспорт

Для каждого товара в заказе нужно иметь возможность определить его объём (либо напрямую, либо на основе размеров/параметров, уже имеющихся в проекте).

Далее:

1. Рассчитать **общий объём** всех товаров в заказе с учётом их количества.
2. Взять `Вмещаемый объём` из выбранного `TransportRestriction` (максимального по ограничениям).
3. Определить, сколько единиц такого транспорта нужно, чтобы перевезти весь объём заказа:
   - Если общий объём **вмещается** в один транспорт — нужен один транспорт.
   - Если общий объём **не вмещается**, необходимо взять ещё один такой же транспорт и повторить проверку.  
   - По сути, нужно определить минимальное целое количество одинаковых транспортных средств, суммарный вмещаемый объём которых >= общему объёму заказа.

Количество необходимых транспортных средств обозначим как `transport_count`.

## Логика расчёта стоимости доставки

1. Получить расстояние `distance_km` от склада до адреса клиента (через API Яндекс.Карт).
2. Получить тарифы из выбранного `TransportRestriction`:
   - `cost_per_km` — стоимость за км;
   - `cost_per_transport` — стоимость за транспорт.
3. Рассчитать стоимость доставки для **одного** транспортного средства:
   - Формула должна учитывать **фиксированную стоимость за транспорт** и **стоимость за расстояние**.  
     Примерный вариант (уточнить и зафиксировать в коде):  
     `delivery_cost_for_one = cost_per_transport + cost_per_km * distance_km`.
4. Общая стоимость доставки заказа:
   - `total_delivery_cost = delivery_cost_for_one * transport_count`.

Итоговая стоимость доставки должна быть рассчитана с использованием типов и валюты, принятых в проекте, и быть пригодной для:
- сохранения в заказе;
- отображения пользователю;
- дальнейшего использования в бизнес-логике (например, при формировании счёта).

## Требования к результату работы

Нужно реализовать отдельный компонент (сервис/класс/функцию), который будет:

1. Принимать идентификатор заказа или сам объект заказа (в зависимости от архитектуры проекта).
2. На основе данных заказа и модели `TransportRestriction`:
   - определять требуемый тип транспорта;
   - рассчитывать необходимое количество транспортных средств;
   - получать расстояние по API Яндекс.Карт;
   - считать итоговую стоимость доставки.
3. Возвращать:
   - числовое значение итоговой стоимости доставки;
   - при необходимости — структуру с деталями расчёта (дистанция, тип транспорта, количество машин, промежуточные суммы).

Без реализации писать нужно только спецификацию и комментарии в коде:  
**не описывать готовое решение и не приводить реализацию здесь**, а реализовать задачу уже в самом проекте на основе этого описания.

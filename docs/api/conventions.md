# Соглашения по API админ‑панели

## Пагинация

- Используется страничная пагинация с параметрами `page` (начиная с 1) и `page_size`.
- Значение `page_size` по умолчанию — 20, допустимый диапазон — 1…100.
- Ответы списков содержат объект `meta.pagination` с полями `page`, `page_size`, `total_items`, `total_pages`, `has_next`, `has_prev`.
- В разделе `links` возвращаются абсолютные URL `self`, `first`, `last`, `next`, `prev` (последние два могут быть `null`).

## Фильтры

- Фильтры передаются в виде `filter[<имя>]`.
- Значения фильтров могут повторяться (`filter[status]=draft&filter[status]=active`) — сервер должен интерпретировать их как множественный выбор.
- Для диапазонных фильтров используется нотация `filter[created][from]` / `filter[created][to]` и аналогичные суффиксы `min`/`max`.

## Поиск и сортировка

- Параметр `search` предназначен для полнотекстового поиска по ключевым полям ресурса.
- Параметр `sort` принимает одно или несколько полей через запятую. Префикс `-` означает сортировку по убыванию.
- Недопустимые поля сортировки приводят к ответу `400` с кодом ошибки `invalid_sort`.

## Формат ошибок

- Ошибки возвращаются с HTTP‑кодами 4xx/5xx в формате:

```json
{
  "errors": [
    {
      "code": "validation_error",
      "title": "Поля заполнены некорректно",
      "detail": "Значение поля sku должно быть уникальным",
      "source": {
        "pointer": "/data/attributes/sku"
      }
    }
  ],
  "trace_id": "01J6GQ9W71J3W1C3ZX1VYJ5K1F"
}
```

- Поле `trace_id` используется для корреляции логов и обязательно для всех ответов об ошибке.
- Значение `source.pointer` соответствует JSON Pointer (RFC 6901); `source.parameter` указывает на имя параметра строки запроса.

## Статусы ответов

- `200 OK` — успешный ответ.
- `201 Created` — ресурс создан, в заголовке `Location` возвращается ссылка на ресурс.
- `204 No Content` — ресурс удалён или операция выполнена без содержимого.
- `400 Bad Request` — ошибка валидации, неверный запрос.
- `401 Unauthorized` — требуется аутентификация.
- `403 Forbidden` — недостаточно прав.
- `404 Not Found` — ресурс не найден.
- `409 Conflict` — конфликт состояний (например, попытка удалить активный заказ).
- `422 Unprocessable Entity` — бизнес‑валидация, отличная от синтаксической (например, резерв превышает остаток).
- `500 Internal Server Error` — непредвиденная ошибка сервера.

## Нотация идентификаторов

- Все ключи возвращаются как UUID v7 в строковом представлении.
- Человеко‑читабельные идентификаторы (например, код заказа) передаются отдельным полем `code`.

## Локализация и числовые значения

- Все суммы передаются в валюте `RUB` (по умолчанию); денежные поля используют тип decimal с точностью 2.
- Даты — в формате ISO 8601; для отметок времени — `date-time` с таймзоной UTC.
- Строки статусов и справочников возвращаются в `snake_case` и документируются в OpenAPI.

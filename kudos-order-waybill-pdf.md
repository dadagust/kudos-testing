# KUDOS ‚Äî –ù–∞–∫–ª–∞–¥–Ω–∞—è –∑–∞–∫–∞–∑–∞ (PDF —á–µ—Ä–µ–∑ WeasyPrint)

## –¶–µ–ª—å
–î–æ–±–∞–≤–∏—Ç—å –≥–µ–Ω–µ—Ä–∞—Ü–∏—é **PDF‚Äë–Ω–∞–∫–ª–∞–¥–Ω–æ–π –ø–æ –∑–∞–∫–∞–∑—É** —Å –ø–∏–∫—Å–µ–ª—å‚Äë–ø–µ—Ä—Ñ–µ–∫—Ç –º–∞–∫–µ—Ç–æ–º ‚Äú–∫–∞–∫ –Ω–∞ —Å–∫—Ä–∏–Ω—à–æ—Ç–µ‚Äù. –ö–Ω–æ–ø–∫–∞ –ø–µ—á–∞—Ç–∏ –¥–æ—Å—Ç—É–ø–Ω–∞ –≤ —Å–ø–∏—Å–∫–∞—Ö –∑–∞–∫–∞–∑–æ–≤ –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–∞—Ö:
- `/logistics/prep` ‚Äî –ø–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –∑–∞–∫–∞–∑–æ–≤;
- `/logistics/receiving` ‚Äî –ø—Ä–∏–µ–º –≤–æ–∑–≤—Ä–∞—Ç–æ–≤.

–ü—Ä–∏ –∫–ª–∏–∫–µ –Ω–∞ –∏–∫–æ–Ω–∫—É —Å–∏—Å—Ç–µ–º–∞ —Ñ–æ—Ä–º–∏—Ä—É–µ—Ç –∏ –æ—Ç–¥–∞–µ—Ç PDF. –î–æ–∫—É–º–µ–Ω—Ç –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç—Å—è –≤ –Ω–æ–≤–æ–π –≤–∫–ª–∞–¥–∫–µ (–∏–ª–∏ —Å–∫–∞—á–∏–≤–∞–µ—Ç—Å—è, –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç –±—Ä–∞—É–∑–µ—Ä–∞).

---

## –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–π —Å—Ü–µ–Ω–∞—Ä–∏–π
1. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å (–ª–æ–≥–∏—Å—Ç, –∫–ª–∞–¥–æ–≤—â–∏–∫, –º–µ–Ω–µ–¥–∂–µ—Ä) –≤–∏–¥–∏—Ç —É —Å—Ç—Ä–æ–∫–∏ –∑–∞–∫–∞–∑–∞ –∏–∫–æ–Ω–∫—É üñ®Ô∏è.
2. –ö–ª–∏–∫–∞–µ—Ç –ø–æ –∏–∫–æ–Ω–∫–µ:
   - –Ω–∞ `/logistics/prep` —Ñ–æ—Ä–º–∏—Ä—É–µ—Ç—Å—è ‚Äú**–ù–∞–∫–ª–∞–¥–Ω–∞—è –Ω–∞ –≤—ã–¥–∞—á—É**‚Äù;
   - –Ω–∞ `/logistics/receiving` ‚Äî ‚Äú**–ù–∞–∫–ª–∞–¥–Ω–∞—è –Ω–∞ –≤–æ–∑–≤—Ä–∞—Ç**‚Äù.
3. PDF –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç—Å—è –≤ –Ω–æ–≤–æ–π –≤–∫–ª–∞–¥–∫–µ. –ú–æ–∂–Ω–æ —Ä–∞—Å–ø–µ—á–∞—Ç–∞—Ç—å/—Å–æ—Ö—Ä–∞–Ω–∏—Ç—å.

---

## –ö–æ–Ω—Ç—Ä–∞–∫—Ç—ã URL –∏ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã
- `GET /logistics/orders/<order_id>/waybill.pdf?context=prep|receiving`
  - `context=prep` ‚Äî –Ω–∞–∫–ª–∞–¥–Ω–∞—è –Ω–∞ –≤—ã–¥–∞—á—É (–∫–æ–ª–æ–Ω–∫–∞ **‚Äú–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø–æ–ª—É—á–∞–µ–º–æ–≥–æ‚Äù** –∑–∞–ø–æ–ª–Ω–µ–Ω–∞; –æ—Å—Ç–∞–ª—å–Ω—ã–µ ‚Äî –ø—É—Å—Ç—ã–µ).
  - `context=receiving` ‚Äî –Ω–∞–∫–ª–∞–¥–Ω–∞—è –Ω–∞ –≤–æ–∑–≤—Ä–∞—Ç (–∫–æ–ª–æ–Ω–∫–∞ **‚Äú–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –≤–æ–∑–≤—Ä–∞—â–∞–µ–º–æ–≥–æ‚Äù** –∑–∞–ø–æ–ª–Ω—è–µ—Ç—Å—è —Ñ–∞–∫—Ç–æ–º –ø—Ä–∏–µ–º–∞; –µ—Å–ª–∏ —Ñ–∞–∫—Ç–∞ –Ω–µ—Ç ‚Äî –ø—É—Å—Ç–æ).
  - –ó–∞–≥–æ–ª–æ–≤–æ–∫: `Content-Type: application/pdf`
  - –û—Ç–≤–µ—Ç: –ø–æ—Ç–æ–∫–æ–≤—ã–π PDF (inline; —á–µ—Ä–µ–∑ `Content-Disposition: inline; filename="waybill-<order_id>.pdf"`).

–ü—Ä–∞–≤–∞ –¥–æ—Å—Ç—É–ø–∞: —Ç–æ–ª—å–∫–æ –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∏ —Å –ø—Ä–∞–≤–æ–º –Ω–∞ –ø—Ä–æ—Å–º–æ—Ç—Ä –∑–∞–∫–∞–∑–∞ –∏ –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤ –ª–æ–≥–∏—Å—Ç–∏–∫–∏ (—Ä–æ–ª—å/permission –≤ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–∏ —Å —Ç–µ–∫—É—â–µ–π RBAC). –ü—Ä–∏ –æ—Ç—Å—É—Ç—Å—Ç–≤–∏–∏ –ø—Ä–∞–≤ ‚Äî 403.

---

## –ò—Å—Ç–æ—á–Ω–∏–∫–∏ –¥–∞–Ω–Ω—ã—Ö (–º–∞–ø–ø–∏–Ω–≥ –ø–æ–ª–µ–π)
–î–æ–∫—É–º–µ–Ω—Ç **–¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –≤–∏–∑—É–∞–ª—å–Ω–æ –∏–¥–µ–Ω—Ç–∏—á–µ–Ω** –º–∞–∫–µ—Ç—É –Ω–∞ —Å–∫—Ä–∏–Ω—à–æ—Ç–µ. –ù–∏–∂–µ ‚Äî —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ –ø–æ–ª–µ–π.

–õ–µ–≤–∞—è —à–∞–ø–∫–∞:
- –õ–æ–≥–æ—Ç–∏–ø **KUDOS** (—Å—Ç–∞—Ç–∏–∫ `kudos.jpg`).
- –ó–∞–≥–æ–ª–æ–≤–æ–∫: `–ó–∞–∫–∞–∑ #{{ order.id }}`.
- **–ê–¥—Ä–µ—Å –¥–æ—Å—Ç–∞–≤–∫–∏:** `order.delivery_address` (–∏–ª–∏ ‚Äú–°–∞–º–æ–≤—ã–≤–æ–∑‚Äù, –µ—Å–ª–∏ `order.delivery_type == PICKUP`).
- **–ú–æ–Ω—Ç–∞–∂:** –¥–∞—Ç–∞ –º–æ–Ω—Ç–∞–∂–∞ –∏ –∏–Ω—Ç–µ—Ä–≤–∞–ª: `order.mount_datetime_from` ‚Äî `order.mount_datetime_to`.
- **–î–µ–º–æ–Ω—Ç–∞–∂:** –¥–∞—Ç–∞ –¥–µ–º–æ–Ω—Ç–∞–∂–∞ –∏ –∏–Ω—Ç–µ—Ä–≤–∞–ª: `order.dismount_datetime_from` ‚Äî `order.dismount_datetime_to`.
- **–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ–± –æ–ø–ª–∞—Ç–µ:** `‚Äú–æ–ø–ª–∞—á–µ–Ω‚Äù | ‚Äú–Ω–µ –æ–ø–ª–∞—á–µ–Ω‚Äù` –∏–∑ –ø–ª–∞—Ç–µ–∂–Ω–æ–≥–æ —Å—Ç–∞—Ç—É—Å–∞ –∑–∞–∫–∞–∑–∞.

–ü—Ä–∞–≤–∞—è —à–∞–ø–∫–∞:
- –ë–ª–æ–∫ –∞—Ä–µ–Ω–¥–æ–¥–∞—Ç–µ–ª—è (—Å—Ç—Ä–æ–≥–∏–π —Ç–µ–∫—Å—Ç –∏–∑ –Ω–∞—Å—Ç—Ä–æ–µ–∫):
  - `settings.WAYBILL_LANDLORD_NAME` (–µ—Å–ª–∏ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ —Ç–æ, ‚Äú–ò–ü –ö–ª–∏–º–æ–≤–∏—Ü–∫–∏–π –ê–ª–µ–∫—Å–µ–π –ú–∏—Ö–∞–π–ª–æ–≤–∏—á‚Äù)
  - `settings.WAYBILL_LANDLORD_ADDR` (–µ—Å–ª–∏ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ —Ç–æ, 105187 , –≥ –ú–æ—Å–∫–≤–∞, –≥. –ú–æ—Å–∫–≤–∞, –í–µ—Ä—Ö–Ω–∏—Å–∞–∂–Ω–∞—è —É–ª., 6)
- –ß–µ–∫‚Äë–ª–∏—Å—Ç —Å –ø—É—Å—Ç—ã–º–∏ —á–µ–∫–±–æ–∫—Å–∞–º–∏ –∏ –ø–æ–ª—è–º–∏ –ø–æ–¥ —á–∏—Å–ª–∞/–æ—Ç–º–µ—Ç–∫–∏ (–≤–∏–∑—É–∞–ª—å–Ω–æ –∫–∞–∫ –Ω–∞ –º–∞–∫–µ—Ç–µ, –∑–Ω–∞—á–µ–Ω–∏—è –Ω–µ –∑–∞–ø–æ–ª–Ω—è—é—Ç—Å—è):
  - –°–µ—Ç–∫–∞
  - –£–≥–æ–ª
  - –Ø—â–∏–∫–∏ –¥–ª—è –ø—Ä–∏–±–æ—Ä–æ–≤
  - –Ø—â–∏–∫–∏ –¥–ª—è –ø–æ—Å—É–¥—ã
  - –Ø—â–∏–∫–∏ –¥–ª—è —Å—Ç–µ–∫–ª–∞
  - –ó–∞–ª–æ–≥
  - –¢—Ä–∞–Ω—Å–ø–æ—Ä—Ç–∏—Ä–æ–≤–æ—á–Ω—ã–µ —á–µ—Ö–ª—ã

–¢–∞–±–ª–∏—Ü–∞ —Å–ø–µ—Ü–∏—Ñ–∏–∫–∞—Ü–∏–∏ (—Å—Ç—Ä–æ–≥–æ –∫–∞–∫ –≤ –º–∞–∫–µ—Ç–µ):
- –ö–æ–ª–æ–Ω–∫–∏ (—Ñ–∏–∫c–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –∑–∞–≥–æ–ª–æ–≤–∫–∏):
  1. `#`
  2. `–ù–∞–∏–º–µ–Ω–æ–≤–∞–Ω–∏–µ`
  3. `–ú–µ—Å—Ç–æ`
  4. `–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø–æ–ª—É—á–∞–µ–º–æ–≥–æ`
  5. `–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –≤–æ–∑–≤—Ä–∞—â–∞–µ–º–æ–≥–æ`
  6. `–£—Ç–µ—Ä—è / –±–æ–π / –ø–æ–≤—Ä–µ–∂–¥–µ–Ω–∏–µ`
  7. `–ü—Ä–∏–º–µ—á–∞–Ω–∏–µ`

- –ù–∞–ø–æ–ª–Ω–µ–Ω–∏–µ:
  - `#` ‚Äî –ø–æ—Ä—è–¥–∫–æ–≤—ã–π –Ω–æ–º–µ—Ä —Å—Ç—Ä–æ–∫–∏.
  - `–ù–∞–∏–º–µ–Ω–æ–≤–∞–Ω–∏–µ` ‚Äî `item.title` (–≤–∞—Ä–∏–∞–Ω—Ç: `product.name + variant`).
  - **prep**: `–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø–æ–ª—É—á–∞–µ–º–æ–≥–æ = item.qty_planned`.
  - **receiving**: `–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –≤–æ–∑–≤—Ä–∞—â–∞–µ–º–æ–≥–æ = item.qty_returned` (–∏–ª–∏ –ø—É—Å—Ç–æ).
  - –û—Å—Ç–∞–ª—å–Ω—ã–µ –∫–æ–ª–æ–Ω–∫–∏ ‚Äî –ø—É—Å—Ç—ã–µ (–∑–∞–ø–æ–ª–Ω—è—é—Ç—Å—è –≤—Ä—É—á–Ω—É—é –Ω–∞ –±—É–º–∞–≥–µ).

–ë–ª–æ–∫–∏ –ø–æ–¥–ø–∏—Å–µ–π(–≤–Ω–∏–∑—É):
- **–í—ã–¥–∞—á–∞ –∑–∞–∫–∞–∑–∞**
  - –°–ª–µ–≤–∞ ‚Äî ‚Äú–ó–∞–∫–∞–∑ –≤—ã–¥–∞–ª, –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∏ —Å–æ—Å—Ç–æ—è–Ω–∏–µ –ø—Ä–æ–≤–µ—Ä–∏–ª –æ—Ç –ê—Ä–µ–Ω–¥–æ–¥–∞—Ç–µ–ª—è: __________________ / __________________‚Äù
  - –°–ø—Ä–∞–≤–∞ ‚Äî ‚Äú–ó–∞–∫–∞–∑ –ø—Ä–∏–Ω—è–ª, –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∏ —Å–æ—Å—Ç–æ—è–Ω–∏–µ –ø—Ä–æ–≤–µ—Ä–∏–ª –æ—Ç –ê—Ä–µ–Ω–¥–∞—Ç–æ—Ä–∞: __________________ / __________________‚Äù
- **–í–æ–∑–≤—Ä–∞—Ç –∑–∞–∫–∞–∑–∞**
  - –°–ª–µ–≤–∞ ‚Äî ‚Äú–ó–∞–∫–∞–∑ –ø—Ä–∏–Ω—è–ª, –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∏ —Å–æ—Å—Ç–æ—è–Ω–∏–µ –ø—Ä–æ–≤–µ—Ä–∏–ª –æ—Ç –ê—Ä–µ–Ω–¥–æ–¥–∞—Ç–µ–ª—è: __________________ / __________________‚Äù
  - –°–ø—Ä–∞–≤–∞ ‚Äî ‚Äú–ó–∞–∫–∞–∑ –ø–µ—Ä–µ–¥–∞–ª, –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∏ —Å–æ—Å—Ç–æ—è–Ω–∏–µ –ø—Ä–æ–≤–µ—Ä–∏–ª –æ—Ç –ê—Ä–µ–Ω–¥–∞—Ç–æ—Ä–∞: __________________ / __________________‚Äù
- –°—Ç—Ä–æ–∫–∏ ‚Äú–ü—Ä–∏–º–µ—á–∞–Ω–∏–µ:‚Äù –ø–æ–¥ –∫–∞–∂–¥—ã–º –±–ª–æ–∫–æ–º ‚Äî –ø—É—Å—Ç—ã–µ.

> ‚ö†Ô∏è –í–∏–∑—É–∞–ª—å–Ω–æ–µ —Å–æ–≤–ø–∞–¥–µ–Ω–∏–µ: –æ—Ç—Å—Ç—É–ø—ã, —Ä–∞–∑–º–µ—Ä—ã —à—Ä–∏—Ñ—Ç–æ–≤, —Ç–æ–ª—â–∏–Ω–∞ –ª–∏–Ω–∏–π, —Ä–∞–∑–º–µ—Ä—ã —á–µ–∫–±–æ–∫—Å–æ–≤, —Ç–µ–Ω–∏ –∏ —Ç.–¥. –¥–æ–ª–∂–Ω—ã —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–æ–≤–∞—Ç—å —Å–∫—Ä–∏–Ω—à–æ—Ç—É.

---

## –ú–∞–∫–µ—Ç PDF (—Å—Ç—Ä–∞–Ω–∏—Ü–∞ –∏ —Ç–∏–ø–æ–≥—Ä–∞—Ñ–∏–∫–∞)
- –§–æ—Ä–º–∞—Ç: **A4, –∞–ª—å–±–æ–º–Ω–∞—è (landscape)**.
- –ü–æ–ª—è: **10 –º–º** –ø–æ –≤—Å–µ–º —Å—Ç–æ—Ä–æ–Ω–∞–º.
- –ë–∞–∑–æ–≤—ã–π —à—Ä–∏—Ñ—Ç: `Inter`, `DejaVu Sans` (fallback), `sans-serif`.
- –†–∞–∑–º–µ—Ä—ã —à—Ä–∏—Ñ—Ç–∞:
  - –ó–∞–≥–æ–ª–æ–≤–æ–∫ ‚Äú–ó–∞–∫–∞–∑ #‚Ä¶‚Äù ‚Äî `18‚Äì20px` –∂–∏—Ä–Ω—ã–π.
  - –ü–æ–¥–ø–∏—Å–∏ —à–∞–ø–∫–∏ –∏ —Ç–∞–±–ª–∏—Ü–∞ ‚Äî `11‚Äì12px`.
- –õ–∏–Ω–∏–∏ —Ç–∞–±–ª–∏—Ü: 1px, —Å–µ—Ä—ã–π `#d5d7db`.
- –ß–µ–∫–±–æ–∫—Å—ã: –∫–≤–∞–¥—Ä–∞—Ç **14√ó14px**, —Ä–∞–º–∫–∞ `#aeb1b7`, –±–µ–∑ –∑–∞–ª–∏–≤–∫–∏.
- –¢–∞–±–ª–∏—Ü–∞:
  - –ó–∞–≥–æ–ª–æ–≤–∫–∏ –≤ `thead` —Å —Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω—ã–º —Ñ–æ–Ω–æ–º `#f0f1f3` –∏ —Ç–æ–Ω–∫–æ–π –≤–Ω—É—Ç—Ä–µ–Ω–Ω–µ–π —Ç–µ–Ω—å—é.
  - `thead { display: table-header-group; }` —á—Ç–æ–±—ã —à–∞–ø–∫–∞ –ø–æ–≤—Ç–æ—Ä—è–ª–∞—Å—å –Ω–∞ –Ω–æ–≤—ã—Ö —Å—Ç—Ä–∞–Ω–∏—Ü–∞—Ö.
  - –†–∞–∑—Ä–µ—à–∏—Ç—å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ –ø–µ—Ä–µ–Ω–æ—Å—ã —Å—Ç—Ä–æ–∫ –≤ —è—á–µ–π–∫–∞—Ö –Ω–∞–∏–º–µ–Ω–æ–≤–∞–Ω–∏–π.
- –õ–æ–≥–æ—Ç–∏–ø KUDOS ‚Äî —Å–ª–µ–≤–∞ —Å–≤–µ—Ä—Ö—É, –≤—ã—Å–æ—Ç–∞ ~**36px**.
- –ë–ª–æ–∫ –∞—Ä–µ–Ω–¥–æ–¥–∞—Ç–µ–ª—è ‚Äî —Å–ø—Ä–∞–≤–∞ –≤—ã—Ä–æ–≤–Ω–µ–Ω –ø–æ –≤–µ—Ä—Ö–Ω–µ–º—É –∫—Ä–∞—é.

---

## –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –∏ —Ñ–∞–π–ª—ã
- –®–∞–±–ª–æ–Ω: `templates/pdf/waybill.html`
- –°—Ç–∏–ª–∏: `static/pdf/waybill.css`
- –ü—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏–µ (Django): `apps/logistics/views/waybill.py` ‚Üí `OrderWaybillPdfView`
- URL: `apps/logistics/urls.py`

---

## –†–µ–∞–ª–∏–∑–∞—Ü–∏—è (Django + WeasyPrint)

### 1) –ù–∞—Å—Ç—Ä–æ–π–∫–∏
`settings.py`:
```python
WAYBILL_LANDLORD_NAME = "–ò–ü –ö–ª–∏–º–æ–≤–∏—Ü–∫–∏–π –ê–ª–µ–∫—Å–µ–π –ú–∏—Ö–∞–π–ª–æ–≤–∏—á"
WAYBILL_LANDLORD_ADDR = "105187, –≥. –ú–æ—Å–∫–≤–∞, –≥. –ú–æ—Å–∫–≤–∞, –í–µ—Ä–Ω–∏—Å–∞–∂–Ω–∞—è —É–ª., 6"
WAYBILL_LOGO_PATH = "img/kudos-logo.svg"   # –≤–Ω—É—Ç—Ä–∏ STATICFILES_DIRS
WAYBILL_DEFAULT_FONT = "DejaVu Sans"
```

### 2) URL
```python
# apps/logistics/urls.py
from django.urls import path
from .views.waybill import OrderWaybillPdfView

urlpatterns = [
    path("orders/<int:pk>/waybill.pdf", OrderWaybillPdfView.as_view(), name="order_waybill_pdf"),
]
```

### 3) View
```python
# apps/logistics/views/waybill.py
from django.conf import settings
from django.http import HttpResponse, Http404
from django.template.loader import render_to_string
from django.views import View
from weasyprint import HTML, CSS
from urllib.parse import unquote
from apps.orders.models import Order
from django.contrib.auth.mixins import LoginRequiredMixin
from apps.common.permissions import StaffPermissionRequired  # –ø—Ä–∏–º–µ—Ä

class OrderWaybillPdfView(LoginRequiredMixin, StaffPermissionRequired, View):
    # permission_required = "orders.view_order"  # –ø—Ä–∏–º–µ—Ä
    def get(self, request, pk):
        context = request.GET.get("context", "prep")
        if context not in {"prep", "receiving"}:
            context = "prep"

        try:
            order = (
                Order.objects
                .select_related("manager")
                .prefetch_related("items", "items__product")
                .get(pk=pk)
            )
        except Order.DoesNotExist:
            raise Http404

        # –ü—Ä–∏–≤–µ–¥–µ–Ω–∏–µ –¥–æ–º–µ–Ω–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö –∫ –Ω—É–∂–Ω—ã–º –ø–æ–ª—è–º —à–∞–±–ª–æ–Ω–∞
        landlord = {
            "name": settings.WAYBILL_LANDLORD_NAME,
            "addr": settings.WAYBILL_LANDLORD_ADDR,
        }

        template_ctx = {
            "order": order,
            "landlord": landlord,
            "context_kind": context,
            "logo_static": settings.WAYBILL_LOGO_PATH,
        }

        html = render_to_string("pdf/waybill.html", template_ctx)
        css = CSS(filename=settings.STATIC_ROOT / "pdf" / "waybill.css")  # –ª–∏–±–æ url=...
        pdf = HTML(string=html, base_url=request.build_absolute_uri("/")).write_pdf(stylesheets=[css])

        resp = HttpResponse(pdf, content_type="application/pdf")
        resp["Content-Disposition"] = f'inline; filename="waybill-{order.pk}.pdf"'
        return resp
```

### 5) –®–∞–±–ª–æ–Ω (—Ñ—Ä–∞–≥–º–µ–Ω—Ç)
> **–í–∞–∂–Ω–æ:** —Ä–∞–∑–º–µ—Ä—ã, –æ—Ç—Å—Ç—É–ø—ã, —Ç–µ–Ω–∏ –∏ —Ü–≤–µ—Ç–∞ –ø–æ–¥–æ–≥–Ω–∞–Ω—ã –ø–æ–¥ —Å–∫—Ä–∏–Ω—à–æ—Ç. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ `mm` –¥–ª—è —Å—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç–∏.

```html
<!-- templates/pdf/waybill.html -->
<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="utf-8" />
<title>–ù–∞–∫–ª–∞–¥–Ω–∞—è ‚Äî –ó–∞–∫–∞–∑ #{{ order.number|default:order.id }}</title>
<link rel="stylesheet" href="{{ STATIC_URL }}pdf/waybill.css">
</head>
<body class="page">
  <header class="header">
    <div class="logo-title">
      <img src="{{ STATIC_URL }}{{ logo_static }}" class="logo" alt="KUDOS">
      <h1>–ó–∞–∫–∞–∑ #{{ order.number|default:order.id }}</h1>
    </div>

    <div class="grid-header">
      <section class="left">
        <dl class="meta">
          <div><dt>–ê–¥—Ä–µ—Å –¥–æ—Å—Ç–∞–≤–∫–∏:</dt><dd>{% if order.is_self_pickup %}–°–∞–º–æ–≤—ã–≤–æ–∑{% else %}{{ order.delivery_address }}{% endif %}</dd></div>
          <div><dt>–ú–æ–Ω—Ç–∞–∂:</dt><dd>{{ order.mount_datetime_from|date:"j E Y, H:i" }} ‚Äî {{ order.mount_datetime_to|date:"H:i" }}</dd></div>
          <div><dt>–î–µ–º–æ–Ω—Ç–∞–∂:</dt><dd>{{ order.dismount_datetime_from|date:"j E Y, H:i" }} ‚Äî {{ order.dismount_datetime_to|date:"H:i" }}</dd></div>
          <div><dt>–ö–æ–Ω—Ç–∞–∫—Ç–Ω–æ–µ –ª–∏—Ü–æ –Ω–∞ –º–æ–Ω—Ç–∞–∂–µ:</dt><dd>{{ order.mount_contact_name }}, {{ order.mount_contact_phone }}</dd></div>
          <div><dt>–ö–æ–Ω—Ç–∞–∫—Ç–Ω–æ–µ –ª–∏—Ü–æ –Ω–∞ –¥–µ–º–æ–Ω—Ç–∞–∂–µ:</dt><dd>{{ order.dismount_contact_name }}, {{ order.dismount_contact_phone }}</dd></div>
          <div><dt>–ú–µ–Ω–µ–¥–∂–µ—Ä –∑–∞–∫–∞–∑–∞:</dt><dd>{{ order.manager.get_full_name }}</dd></div>
          <div><dt>–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π –∫ –∑–∞–∫–∞–∑—É:</dt><dd>{{ order.comment|default:"–Ω–µ—Ç" }}</dd></div>
          <div><dt>–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ–± –æ–ø–ª–∞—Ç–µ:</dt><dd>{% if order.is_paid %}–æ–ø–ª–∞—á–µ–Ω{% else %}–Ω–µ –æ–ø–ª–∞—á–µ–Ω{% endif %}</dd></div>
        </dl>
      </section>

      <section class="right landlord">
        <p class="landlord-title">–ê—Ä–µ–Ω–¥–æ–¥–∞—Ç–µ–ª—å:</p>
        <p>{{ landlord.name }}<br>{{ landlord.addr }}</p>
        <ul class="checks">
          <li><span class="cb"></span> –°–µ—Ç–∫–∞ ______</li>
          <li><span class="cb"></span> –£–≥–æ–ª ______</li>
          <li><span class="cb"></span> –Ø—â–∏–∫–∏ –¥–ª—è –ø—Ä–∏–±–æ—Ä–æ–≤ ______</li>
          <li><span class="cb"></span> –Ø—â–∏–∫–∏ –¥–ª—è –ø–æ—Å—É–¥—ã ______</li>
          <li><span class="cb"></span> –Ø—â–∏–∫–∏ –¥–ª—è —Å—Ç–µ–∫–ª–∞ ______</li>
          <li><span class="cb"></span> –ó–∞–ª–æ–≥ ______</li>
          <li><span class="cb"></span> –¢—Ä–∞–Ω—Å–ø–æ—Ä—Ç–∏—Ä–æ–≤–æ—á–Ω—ã–µ —á–µ—Ö–ª—ã ______</li>
        </ul>
      </section>
    </div>
  </header>

  <main>
    <table class="spec">
      <thead>
        <tr>
          <th>#</th>
          <th>–ù–∞–∏–º–µ–Ω–æ–≤–∞–Ω–∏–µ</th>
          <th>–ú–µ—Å—Ç–æ</th>
          <th>–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø–æ–ª—É—á–∞–µ–º–æ–≥–æ</th>
          <th>–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –≤–æ–∑–≤—Ä–∞—â–∞–µ–º–æ–≥–æ</th>
          <th>–£—Ç–µ—Ä—è / –±–æ–π / –ø–æ–≤—Ä–µ–∂–¥–µ–Ω–∏–µ</th>
          <th>–ü—Ä–∏–º–µ—á–∞–Ω–∏–µ</th>
        </tr>
      </thead>
      <tbody>
        {% for item in order.items.all %}
        <tr>
          <td>{{ forloop.counter }}</td>
          <td>{{ item.title }}</td>
          <td>
            {% if item.place_icon %}<img class="place-ico" src="{{ item.place_icon_url }}">{% endif %}
            {{ item.locations_display }}
          </td>
          <td>{% if context_kind == "prep" %}{{ item.qty_planned }}{% endif %}</td>
          <td>{% if context_kind == "receiving" %}{{ item.qty_returned }}{% endif %}</td>
          <td></td>
          <td></td>
        </tr>
        {% endfor %}
      </tbody>
    </table>

    <section class="sign-block">
      <h3>–í—ã–¥–∞—á–∞ –∑–∞–∫–∞–∑–∞</h3>
      <div class="sign-row">
        <div>–ó–∞–∫–∞–∑ –≤—ã–¥–∞–ª, –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∏ —Å–æ—Å—Ç–æ—è–Ω–∏–µ –ø—Ä–æ–≤–µ—Ä–∏–ª –æ—Ç –ê—Ä–µ–Ω–¥–æ–¥–∞—Ç–µ–ª—è: <span class="line"></span> / <span class="line"></span></div>
        <div>–ó–∞–∫–∞–∑ –ø—Ä–∏–Ω—è–ª, –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∏ —Å–æ—Å—Ç–æ—è–Ω–∏–µ –ø—Ä–æ–≤–µ—Ä–∏–ª –æ—Ç –ê—Ä–µ–Ω–¥–∞—Ç–æ—Ä–∞: <span class="line"></span> / <span class="line"></span></div>
      </div>
      <div class="note">–ü—Ä–∏–º–µ—á–∞–Ω–∏–µ: <span class="line wide"></span></div>
    </section>

    <section class="sign-block">
      <h3>–í–æ–∑–≤—Ä–∞—Ç –∑–∞–∫–∞–∑–∞</h3>
      <div class="sign-row">
        <div>–ó–∞–∫–∞–∑ –ø—Ä–∏–Ω—è–ª, –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∏ —Å–æ—Å—Ç–æ—è–Ω–∏–µ –ø—Ä–æ–≤–µ—Ä–∏–ª –æ—Ç –ê—Ä–µ–Ω–¥–æ–¥–∞—Ç–µ–ª—è: <span class="line"></span> / <span class="line"></span></div>
        <div>–ó–∞–∫–∞–∑ –ø–µ—Ä–µ–¥–∞–ª, –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∏ —Å–æ—Å—Ç–æ—è–Ω–∏–µ –ø—Ä–æ–≤–µ—Ä–∏–ª –æ—Ç –ê—Ä–µ–Ω–¥–∞—Ç–æ—Ä–∞: <span class="line"></span> / <span class="line"></span></div>
      </div>
      <div class="note">–ü—Ä–∏–º–µ—á–∞–Ω–∏–µ: <span class="line wide"></span></div>
    </section>
  </main>
</body>
</html>
```

### 6) CSS (—Ñ—Ä–∞–≥–º–µ–Ω—Ç ‚Äî –∫–ª—é—á–µ–≤—ã–µ –º–æ–º–µ–Ω—Ç—ã —Å–æ–≤–ø–∞–¥–µ–Ω–∏—è —Å –º–∞–∫–µ—Ç–æ–º)
```css
/* static/pdf/waybill.css */
@page { size: A4 landscape; margin: 10mm; }

body.page { font-family: "Inter", "DejaVu Sans", sans-serif; font-size: 11.5px; color: #111827; }

.header .logo { height: 36px; }
.header .logo-title { display: flex; align-items: center; gap: 12mm; margin-bottom: 6mm; }
.header h1 { font-size: 20px; font-weight: 700; margin: 0; }

.grid-header { display: grid; grid-template-columns: 1fr 0.9fr; gap: 10mm; }

.meta dt { width: 48mm; float: left; color: #4b5563; }
.meta dd { margin-left: 50mm; margin-bottom: 1.2mm; }

.landlord-title { font-weight: 700; margin: 0 0 1mm; }
.checks { list-style: none; padding: 0; margin: 3mm 0 0; }
.checks li { display: flex; align-items: center; gap: 2mm; margin-bottom: 2mm; }
.cb { display: inline-block; width: 14px; height: 14px; border: 1px solid #aeb1b7; }

table.spec { width: 100%; border-collapse: collapse; margin-top: 6mm; }
table.spec thead th {
  background: #f0f1f3; border: 1px solid #d5d7db; padding: 2mm; font-weight: 600;
  box-shadow: inset 0 1px 0 rgba(0,0,0,.05);
}
table.spec td { border: 1px solid #d5d7db; padding: 2mm; vertical-align: top; }
thead { display: table-header-group; }

.place-ico { width: 10mm; height: auto; margin-right: 2mm; }

.sign-block { margin-top: 6mm; }
.sign-block h3 { font-size: 12.5px; margin: 0 0 2mm; }
.sign-row { display: grid; grid-template-columns: 1fr 1fr; gap: 6mm; margin-bottom: 2mm; }
.line { display: inline-block; border-bottom: 1px solid #9ca3af; width: 35mm; height: 4mm; }
.line.wide { width: 100%; height: 6mm; }
.note { margin-top: 2mm; }
```

---

## –í—Å—Ç—Ä–∞–∏–≤–∞–Ω–∏–µ –∏–∫–æ–Ω–∫–∏ –ø–µ—á–∞—Ç–∏ –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–∞—Ö
–í —Ç–∞–±–ª–∏—Ü–∞—Ö –∑–∞–∫–∞–∑–æ–≤ `/logistics/prep` –∏ `/logistics/receiving` –¥–ª—è –∫–∞–∂–¥–æ–π —Å—Ç—Ä–æ–∫–∏:
```html
<a class="btn-print" href="{% url 'order_waybill_pdf' order.id %}?context=prep" target="_blank" title="–ü–µ—á–∞—Ç—å">
  <!-- SVG-–∏–∫–æ–Ω–∫–∞ –ø—Ä–∏–Ω—Ç–µ—Ä–∞ -->
  <svg width="18" height="18" viewBox="0 0 24 24" aria-hidden="true">‚Ä¶</svg>
</a>
```
–î–ª—è —Å—Ç—Ä–∞–Ω–∏—Ü—ã –≤–æ–∑–≤—Ä–∞—Ç–∞ –∑–∞–º–µ–Ω–∏—Ç–µ `context=receiving`.

–ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–µ —Å—Ç–∏–ª–∏:
```css
.btn-print { display: inline-flex; align-items: center; padding: 4px; border-radius: 6px; }
.btn-print:hover { background: #f3f4f6; }
```

## –ì–æ—Ç–æ–≤–Ω–æ—Å—Ç—å/–∫—Ä–∏—Ç–µ—Ä–∏–∏ –ø—Ä–∏–µ–º–∫–∏
- –ò–∫–æ–Ω–∫–∞ –ø–µ—á–∞—Ç–∏ –Ω–∞ –æ–±–æ–∏—Ö —Å–ø–∏—Å–∫–∞—Ö –ø—Ä–∏—Å—É—Ç—Å—Ç–≤—É–µ—Ç, –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç –≤–µ—Ä–Ω—ã–π —Ç–∏–ø –Ω–∞–∫–ª–∞–¥–Ω–æ–π.
- –ú–∞–∫–µ—Ç PDF –≤–∏–∑—É–∞–ª—å–Ω–æ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç —Å–∫—Ä–∏–Ω—à–æ—Ç—É (–æ—Ç—Å—Ç—É–ø—ã, —à—Ä–∏—Ñ—Ç—ã, —Ü–≤–µ—Ç–∞, —Å–µ—Ç–∫–∞, —á–µ–∫–±–æ–∫—Å—ã).
- –í—Å–µ –ø–æ–ª—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ –ø–æ–¥—Å—Ç–∞–≤–ª—è—é—Ç—Å—è –∏–∑ –¥–∞–Ω–Ω—ã—Ö –∑–∞–∫–∞–∑–∞.
- –ü–æ–≤—Ç–æ—Ä —à–∞–ø–∫–∏ —Ç–∞–±–ª–∏—Ü—ã –ø—Ä–∏ –ø–µ—Ä–µ–Ω–æ—Å–µ –Ω–∞ —Å–ª–µ–¥—É—é—â—É—é —Å—Ç—Ä–∞–Ω–∏—Ü—É ‚Äî —Ä–∞–±–æ—Ç–∞–µ—Ç.
- –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –¥–æ—Å—Ç—É–ø–Ω–∞ —Ç–æ–ª—å–∫–æ —É–ø–æ–ª–Ω–æ–º–æ—á–µ–Ω–Ω—ã–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º.

---

## –ó–∞–º–µ—á–∞–Ω–∏—è –ø–æ –ø–∏–∫—Å–µ–ª—å‚Äë–ø–µ—Ä—Ñ–µ–∫—Ç
- –ï—Å–ª–∏ –Ω–∞–±–ª—é–¥–∞–µ—Ç—Å—è ¬´—Ç–æ–ª—â–µ/—Ç–æ–Ω—å—à–µ¬ª –ª–∏–Ω–∏–∏ ‚Äî —Ä–µ–≥—É–ª–∏—Ä—É–π—Ç–µ `border-color` –∏ `rgba`‚Äë—Ç–µ–Ω–∏.
- –î–ª—è –ø–æ–ª–Ω–æ–≥–æ —Å–æ–≤–ø–∞–¥–µ–Ω–∏—è —à—Ä–∏—Ñ—Ç–∞ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ **Inter** –∏–∑ —Å—Ç–∞—Ç–∏–∫–∏ (`static/fonts/Inter/‚Ä¶`) –∏ –æ–±—ä—è–≤–∏—Ç–µ `@font-face` –≤ CSS.
- –ß–µ–∫–±–æ–∫—Å—ã –∏ –ø–æ–¥–ø–∏—Å–∏ ‚Äî –∏–º–µ–Ω–Ω–æ —Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö —Ä–∞–∑–º–µ—Ä–æ–≤. –ù–µ –∑–∞–º–µ–Ω—è—Ç—å –Ω–∞—Ç–∏–≤–Ω—ã–º–∏ input, —Ä–∏—Å–æ–≤–∞—Ç—å CSS‚Äë—Ä–∞–º–∫–∞–º–∏.


## –ü–ª–∞–Ω –≤–Ω–µ–¥—Ä–µ–Ω–∏—è
1. –ü–æ—Å—Ç–∞–≤–∏—Ç—å —Å–∏—Å—Ç–µ–º–Ω—ã–µ –±–∏–±–ª–∏–æ—Ç–µ–∫–∏ –∏ `weasyprint` –≤ –æ–±—Ä–∞–∑.
2. –î–æ–±–∞–≤–∏—Ç—å —à–∞–±–ª–æ–Ω, CSS –∏ view.
3. –ü—Ä–æ–ø–∏—Å–∞—Ç—å URL –∏ –ø—Ä–∞–≤–∞.
4. –ü–æ–¥–∫–ª—é—á–∏—Ç—å –∏–∫–æ–Ω–∫–∏ –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–∞—Ö `/logistics/prep` –∏ `/logistics/receiving`.
